<!-- our network -->

<cluster id="vnet" bandwidthdown="1024000" bandwidthup="1024000" />
<link clusters="vnet vnet" latency="60" jitter="20" packetloss="0.0" />

<!-- the plug-ins we will be using -->

<plugin id="file" path="~/.shadow/plugins/libshadow-plugin-filetransfer.so" />
<plugin id="tor" path="~/.shadow/plugins/libshadow-plugin-scallion.so" />
<plugin id="torctl" path="~/.shadow/plugins/libshadow-plugin-torcontrol.so" />

<!-- the length of our experiment in seconds -->

<kill time="3600" />

<!-- our services -->

<node id="fileserver" bandwidthdown="10240000" bandwidthup="10240000" >
    <application plugin="file" time="1" arguments="server 80 ~/.shadow/share/" />
</node >

<!--node id="hiddenserver" bandwidthdown="102400" bandwidthup="102400" >
    <application plugin="file" time="1" arguments="server 8080 ~/.shadow/share/" />
    <application plugin="tor" time="900" arguments="client 1024 1024000 1024000 ./hiddenserver.torrc ./data/hiddenserverdata ~/.shadow/share/geoip" />
    <application plugin="torctl" time="901" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
</node >

<!-- our Tor network infrastructure -->

<node id="4uthority" >
    <application plugin="tor" time="1" arguments="dirauth 1024 1024000 1024000 ./authority.torrc ./data/authoritydata ~/.shadow/share/geoip" />
    <!--<application plugin="torctl" time="2" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    -->
</node >
<node id="exit" quantity="1"  bandwidthdown="10240000" bandwidthup="10240000" >
    <application plugin="tor" time="60" arguments="exitrelay 1024 1024000 1024000 ./exit.torrc ./data/exitdata ~/.shadow/share/geoip" />
    <!--<application plugin="torctl" time="61" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    -->
</node >
<node id="fastrelay" quantity="1"  bandwidthdown="10240000" bandwidthup="10240000" >
    <application plugin="tor" time="60" arguments="relay 1024 1024000 1024000 ./fastrelay.torrc ./data/relaydata ~/.shadow/share/geoip" />
    <!--<application plugin="torctl" time="61" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    -->
</node>
<node id="slowrelay" quantity="1"  bandwidthdown="10240000" bandwidthup="10240000" >
    <application plugin="tor" time="60" arguments="relay 1024 1024000 1024000 ./slowrelay.torrc ./data/relaydata ~/.shadow/share/geoip" />
    <!--<application plugin="torctl" time="61" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    -->
</node>


<!-- our Tor client, downloads a 1MiB file 10 times -->

<node id="lightfileclient" >
    <application plugin="tor" time="900" arguments="client 1024 1024000 1024000 ./client.torrc ./data/clientdata ~/.shadow/share/geoip" />
    <!--<application plugin="torctl" time="901" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    -->
    <!--application plugin="file" time="1200" arguments="client single fileserver 80 localhost 9000 1 /1MiB.urnd" /-->
    <application plugin="file" time="1200" arguments="client single fileserver 80 localhost 9000 100 /1MiB.urnd" />
    <!--application plugin="file" time="1200" arguments="client multi ./download-spec localhost 9000 ./think-time -1` 2" /-->
</node >

<!--node id="bulkfileclient" >
    <application plugin="tor" time="900" arguments="client 1024 1024000 1024000 ./client.torrc ./data/clientdata ~/.shadow/share/geoip" />
    <application plugin="file" time="1200" arguments="client single fileserver 80 localhost 9000 30 /5MiB.urnd" />
    
</node>

<!--node id="hiddenclient" >
	
    <application plugin="tor" time="900" arguments="client 1024 1024000 1024000 ./client.torrc ./data/clientdata ~/.shadow/share/geoip" />
    <application plugin="torctl" time="901" arguments="single localhost 9051 log STREAM,CIRC,CIRC_MINOR,ORCONN,BW,STREAM_BW,OR_BW,DIR_BW,EXIT_BW,BUILDTIMEOUT_SET,CLIENTS_SEEN,GUARD,CELL_STATS,TOKENS,OR_TOKENS" />
    <application plugin="file" time="1200" arguments="client single hxsttdz4esasch5x.onion 80 localhost 9000 10 /1MiB.urnd" />
</node >
